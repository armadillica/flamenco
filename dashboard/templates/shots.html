{% extends "layout.html" %}
{% block footer_scripts %}
<script type="text/javascript">
	$(document).ready(function() {   
		var shotsTable = $('#shots').dataTable({
			"bProcessing": true,
			"iDisplayLength": 25,
			"aaData": {{ entries | safe }},
			"aoColumns": [
				{ "bSortable": false },
			    null,
			    null,
			    null,
			    null
			],

			"fnRowCallback": function( nRow, aData, iDisplayIndex, iDisplayIndexFull ) {

				$('td:eq(2)', nRow).html('<div class="progress"><div class="bar" style="width: ' + aData[2] + '%;"></div></div>');
	    	}
		});


		$(document).on("click", "#shot-delete", function() {
			console.log('delete');

			var shots = new Array();

			var checkbox_list = $( "tbody input:checked" );
			for (var i = checkbox_list.length - 1; i >= 0; i--) {
				var checkbox = checkbox_list[i];
				shots.push($(checkbox).val());
			};

			console.log(shots);
			shot_ids = shots.join();
  			
  			$.post("/shots/delete", { 'id' : shot_ids})
  			.done(function(data) {
  				// we reuse the checkbox list to delete the table rows we just
  				// removed in the database table
  				for (var i = checkbox_list.length - 1; i >= 0; i--) {
					var checkbox = checkbox_list[i];
					var tableRow = $(checkbox).parents("tr");
					// make sure to treat tableRow as an array and onlu get
					// the first value (there is only one actually)
					var aPos = shotsTable.fnGetPosition( tableRow[0] );
					shotsTable.fnDeleteRow(aPos);
				};
				console.log('Shot removed from table');
			});

		});

		$(document).on("click", ".check-all", function(){
			$("table input[type=checkbox]").attr('checked', $(this).is(':checked'));
		});


	});
</script>
{% endblock %}
{% block body %}
	<div class="page-header">
	    <h1>Shots</h1>
	</div>
	<div class="row">
		<div class="span10">
			<div class="btn-toolbar">
				<div class="btn-group">
					<div id="shot-disable" class="btn">Start</div>
					<div id="shos-enable" class="btn">Stop</div>
					<div id="shos-pause" class="btn">Pause</div>
				</div>
				<div class="btn-group">
					<div id="shot-delete" class="btn btn-danger">Delete</div>
				</div>
			</div>
		</div>
	</div>
	<hr>
	<div class="row">
		<div class="span10">
			<table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" id="shots">
				<thead>
					<tr>
						<th width="5%"><input class="check-all" type="checkbox"></th>
						<th width="30%">Shot (thumbnail)</th>
						<th width="30%">Completion</th>
						<th width="20%">Configuration</th>
						<th width="20%">Status</th>
					</tr>
				</thead>
				<tbody>

				</tbody> 
				<tfoot>
					<tr>
						<th></th>
						<th>Shot</th>
						<th>IP Address</th>
						<th>Connection</th>
						<th>Status</th>
					</tr>
				</tfoot>
			</table>	
		</div>
	</div>

{% endblock %}