{% extends "layout.html" %}
{% block footer_scripts %}
<script type="text/javascript">
    $(document).ready(function() {
        var workersTable = $('#workers').dataTable({
            "bProcessing": true,
            "iDisplayLength": 25,
            "aaData": {{ entries | safe }},
            "aoColumns": [
                 { "bSortable": false },
                 null,
                 null,
                 null,
                 null,
                 null
             ],

            "fnRowCallback": function( nRow, aData, iDisplayIndex, iDisplayIndexFull ) {
                var btn_status = "";
                if (aData[4] == "offline"){
                    $('td:eq(4)', nRow).html('<span class="label label-danger">offline</span>');
                    btn_status = "disabled";
                } else if (aData[4] == "online"){
                    $('td:eq(4)', nRow).html('<span class="label label-success">online</span>');
                }

                if (aData[5] == "enabled"){
                    $('td:eq(5)', nRow).html('<span class="status-toggle btn btn-xs btn-success ' + btn_status + '">enabled</span>');
                } else if (aData[5] == "disabled"){
                    $('td:eq(5)', nRow).html('<span class="status-toggle btn btn-xs btn-warning ' + btn_status + '">disabled</span>');
                }
            }

        });

        $("div.toolbar").html('Custom tool bar! Text/images etc.');

        $(document).on("click", ".status-toggle", function() {
            var status = $(this).html();
            var tableRow = $(this).parents("tr");
            var rowPosition = workersTable.fnGetPosition(tableRow[0]);
            var workerId = tableRow.attr("id").split("_")[1];

            if (status == 'enabled') {
                data = {id : workerId, status: 'disabled'};
                $.post('/workers/edit', data, function() {
                    console.log('Worker is now disabled');
                    workersTable.fnUpdate('disabled', rowPosition ,5);
                });
            } else if (status == 'disabled') {
                data = {id : workerId, status: 'enabled'};
                $.post('/workers/edit', data, function() {
                    console.log('Worker is now enabled');
                    workersTable.fnUpdate('enabled', rowPosition ,5);
                });
            }
        });

        $(document).on("click", ".check-all", function(){
            $("table input[type=checkbox]").attr('checked', $(this).is(':checked'));
        });

    });
</script>
{% endblock %}
{% block body %}

    <h1>Workers</h1>
    <hr>
    <div class="row">
        <div class="col-md-12">
            <!-- Single button -->
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                Action <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu">
                <li><a href="#" id="workers-disable">Disable</a></li>
                <li><a href="#" id="workers-enable">Enable</a></li>
                <li class="divider"></li>
                <li><a href="#">Restart</a></li>
              </ul>
            </div>
        </div>
    </div>
    <hr>
    <div class="row">
        <div class="col-md-12">
            <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-condensed" id="workers">
                <thead>
                    <tr>
                        <th width="5%"><input class="check-all" type="checkbox"></th>
                        <th width="20%">Hostname</th>
                        <th width="20%">System</th>
                        <th width="20%">IP Address</th>
                        <th width="20%">Connection</th>
                        <th width="20%">Status</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>
                <tfoot>
                    <tr>
                        <th></th>
                        <th>Hostname</th>
                        <th>System</th>
                        <th>IP Address</th>
                        <th>Connection</th>
                        <th>Status</th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

{% endblock %}
